<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--namespace:映射文件的命名空间，规范是映射文件的全路径-->
<!--作用:是一- 个路径，用来查找下面的id-->
<mapper namespace="com.njj.dao.StudentDao">
   <resultMap id="studentMap" type="com.njj.bean.Student">
       <!--下面的标签要映射到实体类-->
       <!--id只有1个-->
       <!--column.是数据库中的  列名 很多事下划线-->
       <!--property是实体类中的属性  一般是驼峰-->
       <id column="s_id" property="s_id"/>
       <result column="s_name" property="s_name"/>
       <result column="s_birth" property="s_birth"/>
       <result column="s_sex" property="s_sex"/>


   </resultMap>

    <!--1.查询"01"课程比 “02”课程成绩高的学生的信息及课程分数-->
    <select id="selectByScore" resultType="map" parameterType="map">
        select s1.*,s2.s_score score1,s3.s_score score2 from student s1,Score s2,Score s3 where s1.s_id=s2.s_id and s1.s_id=s3.s_id and s2.c_id="01" and s3.c_id="02" and s2.s_score>s3.s_score
    </select>

    <!--//2.查询"01"课程比"02"课程成绩低的学生的信息及课程分数-->
    <select id="selectByScore02" resultType="map" parameterType="map">
        <![CDATA[ select s.* ,b.s_score as 1score,c.s_score as 2score from student s join score b on s.s_id=b.s_id and b.c_id='01' left join score c on s.s_id=c.s_id and c.c_id='02' or c.c_id = NULL where b.s_score<c.s_score]]>
    </select>

    <!--3、查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩-->
    <select id="selectStudent" resultType="map" parameterType="map">
        select s.s_id,s.s_name,ROUND(AVG(a.s_score),2) as avg_score from student s join score a on s.s_id = a.s_id GROUP BY s.s_id,s.s_name HAVING ROUND(AVG(a.s_score),2)>=60
    </select>

    <!--4、查询平均成绩小于60分的同学的学生编号和学生姓名和平均成绩_-->
    <select id="selectStudent02" resultType="map" parameterType="map">
        <![CDATA[select s1.s_id,s1.s_name,avg(s2.s_score) avgScore from Student s1,Score s2 where s1.s_id=s2.s_id group by s2.s_id HAVING avg(s2.s_score) <= 60]]>
    </select>

    <!--5、查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩-->
    <select id="selectCount" resultType="map">
        select s.s_id,s.s_name,count(b.c_id) as sum_course,sum(b.s_score) as sum_score from student s left join score b on s.s_id=b.s_id GROUP BY s.s_id,s.s_name
    </select>

    <!--6、查询"李"姓老师的数量-->
    <select id="selectByLikeName" resultType="map" parameterType="map">
        select count(t_id) from teacher where t_name like "%"#{t_name}"%"
    </select>


    <!--7.查询学过"张三”老师授课的同学的信息-->
    <select id="selectByName" resultType="map" parameterType="map">
        select s1.* from Student s1,Score s2,Course c,Teacher t where s1.s_id=s2.s_id and c.c_id=s2.c_id and t.t_id=c.t_id and t.t_name =#{t_name}
    </select>

    <!--8、查询没学过"张三"老师授课的同学的信息-->
    <select id="selectBynotName" resultType="map" parameterType="map">
        select * from student c where c.s_id not in(select s.s_id from student s join score b on s.s_id=b.s_id where b.c_id in(select c_id from course where t_id =(select t_id from teacher where t_name = #{name})));
    </select>

    <!--9、查询学过编号为"01"并且也学过编号为"02"的课程的同学的信息-->
    <select id="selectByid01or02" resultType="map" parameterType="map">
        select s.* from student s,score b,score c where s.s_id = b.s_id  and s.s_id = c.s_id and b.c_id='01' and c.c_id='02';
    </select>

    <!--10、查询学过编号为"01"但是没有学过编号为"02"的课程的同学的信息-->
    <select id="selectBynoid01or02" resultType="map" parameterType="map">
        select s.* from student s where s.s_id in (select s_id from score where c_id='01' ) and s.s_id not in(select s_id from score where c_id='02');
    </select>



</mapper>